---
title: "PC2_03 SEM 10"
format: html
editor: visual
---

# Cargar e instalar paquetes

En esta secci√≥n se instalan y cargan los paquetes necesarios para realizar el an√°lisis estad√≠stico, manejo de datos y visualizaci√≥n. Se utiliza principalmente el paquete `tidyverse` para manipulaci√≥n de datos, `car` para pruebas estad√≠sticas, y `ggplot2` para graficar.

```{r}
install.packages("car")
```

Ahora importaremos las librerias las cuales usaremos para nuestro analisis de datos

```{r}
library(tidyverse)
library(here)
library(rio)
library(gtsummary)
library(car)
```

# Cargando los datos

Ahora importamos nuestra data asignada:

```{r}
cirrosis. <- import(here("data", "cirrosis_2.csv"))
```

# Sobre los datos para esta pr√°ctica

Los datos representan una muestra de 418 pacientes con diagn√≥stico de cirrosis, con el objetivo de evaluar factores asociados al estado cl√≠nico y su evoluci√≥n.\
En esta pr√°ctica se explorar√°n relaciones entre variables cuantitativas (como bilirrubina, edad, alb√∫mina) y categ√≥ricas (como medicamento o sexo) mediante an√°lisis estad√≠stico.

# 1 Regresi√≥n lineal simple

Regresi√≥n es una m√©todo para evaluar la asociaci√≥n entre una variable dependiente (tambien llamado desenlace Y) y una o varias variables independientes (predictoras X1, X2,..., Xk). Los modelos de regresi√≥n lineal simple (o univariable) utilizan solo solo una variable independiente o predictora X. Ejemplos de preguntas de investigaci√≥n se puede responder usando un modelo de regresi√≥n lineal:

## 1.1 El problema en este ejercicio

La f√≥rmula que usaremos sirve para crear un histograma que muestra los valores de bilirrubina en un grupo de personas cirr√≥ticas, y a√±ade una l√≠nea vertical que indica el promedio de esta variable para reconocer la cantidad m√°s frecuente y c√≥mo se compara con la media del grupo.

```{r}
ggplot(cirrosis_2.csv, aes(x = bilirrubina)) +
  geom_histogram(fill = "pink", color = "brown", bins = 30) +
  geom_vline(xintercept = mean(cirrosis_2.csv$bilirrubina, na.rm = TRUE),
             color = "darkgreen", linewidth = 1) +
  labs(y = "Frecuencia", x = "bilirrubina")

```

En estos datos, el promedio de la bilirrubina es:

```{r}
mean(cirrosis_2.csv$bilirrubina, na.rm = TRUE)
```

Una observaci√≥n importante a partir del histograma y el promedio (el valor esperado) es que existe una gran variaci√≥n entre los valores de bilirrubina de los individuos de quienes provienen los datos. Podemos hipotetizar de que otras variables (predictores) podr√≠an influir en esta variaci√≥n, por ejemplo, el medicamento que consumen por la enfermedad.

## 1.2 Notaci√≥n en el m√©todo de regresi√≥n lineal simple

```{r}
plot(bilirrubina ~ edad , data = cirrosis_2.csv,
     col = "pink",
     ylab = "bilirrubina",
     xlab = "edad",
     las = 1,
     pch = 20, 
     font.lab = 2, font.axis = 2) 

# La funci√≥n lm() ajusta el modelo de regresi√≥n lineal
abline(lm(bilirrubina ~ edad , data = cirrosis_2.csv), lwd = 2, col = "purple")
```

La ecuaci√≥n siguiente ecuaci√≥n describe un modelo de regresi√≥n lineal simple para ùëå usando un predictor continuo ùëã.

$$
Y = \beta_0 + \beta_1 X + \epsilon
$$

**Interpretacion**:\
La l√≠nea de regresi√≥n presenta una pendiente casi horizontal, lo que indica que no existe una relaci√≥n lineal significativa entre la edad y los niveles de bilirrubina.\
Es decir, los cambios en la edad no parecen influir de gran manera en los valores de bilirrubina en esta muestra

## 1.3 Ajustando el modelo de regresi√≥n lineal simple para nuestro problema

En R, usamos la funci√≥n lm() para ajustar un modelo de regresi√≥n lineal. "lm" es la abreviatura para "linear model". Dentro de la funci√≥n debemos indicarle como argumentos el desenlace X, el predictor Y y la data donde se encuentran las variables. Esta es la estructura para ajustar el modelo con la funci√≥n lm: lm(y \~ x, data = mis_datos).

Ajustando el modelo para nuestros datos

```{r}
modelo_ejemplo_cirrosis = lm(bilirrubina ~ edad, data = cirrosis_2.csv)
```

Para ver los resultados, usamos la funci√≥n summary() y dentro, el objeto modelo_ejemplo.

```{r}
summary(modelo_ejemplo_cirrosis)
```

**Interpretacion**

El intercepto es 3.18 y la pendiente 0.0007.\
Esto indica que, por cada a√±o m√°s de edad, la bilirrubina aumentar√≠a en promedio 0.0007 mg/dL, un cambio casi nulo.\
El modelo solo explica el 0 % de la variabilidad, por lo que la edad no ayuda a predecir los niveles de bilirrubina.

## 1.4 Interpretando los resultados

La secci√≥n Coefficients del resultado:

```{r}
summary(modelo_ejemplo_cirrosis)$coef
```

La tabla de coeficientes muestra las estimaciones y las pruebas de hip√≥tesis tanto para el intercepto (Œ≤‚ÇÄ), etiquetado como *(Intercept)*, como para el coeficiente de la variable Edad, que representa la pendiente (Œ≤‚ÇÅ) de la recta de regresi√≥n.

En esta secci√≥n, la columna *Estimate* indica que el modelo que mejor se ajusta a los datos tiene un intercepto de 3.18 y una pendiente de 0.0007.\
Esto significa que, seg√∫n el modelo, una persona con edad igual a 0 tendr√≠a un valor promedio de bilirrubina de 3.18 mg/dL, aunque este valor carece de interpretaci√≥n cl√≠nica directa, ya que no existen pacientes con edad cero.\
La pendiente indica que por cada a√±o adicional de edad, el nivel promedio de bilirrubina aumentar√≠a en 0.0007 mg/dL, lo cual representa un cambio extremadamente peque√±o y sin relevancia pr√°ctica.

Sin embargo, el valor p de la variable Edad es 0.9719, muy superior al nivel de significancia habitual (0.05).\
Esto indica que el coeficiente de la edad no es estad√≠sticamente significativo, por lo que no se puede rechazar la hip√≥tesis nula de que la pendiente es igual a cero.\
En otras palabras, no se evidencia una relaci√≥n lineal significativa entre la edad y la bilirrubina en esta muestra.

Adem√°s, el coeficiente de determinaci√≥n (R¬≤ = 0.00000299) muestra que el modelo no explica pr√°cticamente nada de la variabilidad observada en los niveles de bilirrubina.

## 1.5 ¬øC√≥mo reportar los resultados del ajuste del modelo de regresi√≥n lineal simple?

Empleamos un modelo de regresi√≥n lineal simple para evaluar la asociaci√≥n entre la edad (en a√±os) y los niveles de bilirrubina en una muestra de 418 personas.\
Solo el 0.0003 % de la variaci√≥n en los niveles de bilirrubina fue explicada por la edad (R¬≤ = 0.00000299).\
No se encontr√≥ una asociaci√≥n estad√≠sticamente significativa entre ambas variables (B = 0.0007; p = 0.9719).\
En promedio, por cada a√±o adicional de edad, el nivel de bilirrubina aumenta √∫nicamente 0.0007 mg/dL, lo cual representa un cambio m√≠nimo y cl√≠nicamente irrelevante.\
Estos resultados indican que la edad no tiene un efecto importante ni significativo sobre los niveles de bilirrubina en esta muestra.

```{r}
theme_gtsummary_language("es")

tabla_reporte <- modelo_ejemplo_cirrosis |> 
  tbl_regression(intercept = T,
                 estimate_fun = function(x) style_sigfig(x, digits = 4),
                 pvalue_fun   = function(x) style_pvalue(x, digits = 3),
                 label        = list( edad~ "edad (a√±os)")) |>
  modify_caption("Regresi√≥n de la variable cirrosis en funci√≥n a la edad")

tabla_reporte
```

**Exportamos la tabla**

```{r}
tabla_reporte |> 
  as_flex_table()  |> 
  flextable::save_as_docx(path = "tabla_reporte.docx")
```

## PRUEBAS DE BONDAD DE AJUSTE

```{r}
# Prueba de Shapiro-Wilk para normalidad de la bilirrubina
cirrosis_2.csv |>
summarise(shapiro = list(shapiro.test(bilirrubina))) |>
pull(shapiro)
```

**Interpretaci√≥n:**

-   El valor p es menor que 0.05 (p \< 2.2e-16)

-   **Conclusi√≥n:** Rechazamos la hip√≥tesis nula de normalidad

-   La variable bilibirrubina NO sigue una distribuci√≥n normal en estos datos

-   El valor W de 0.63197 est√° muy lejos de 1 (que indicar√≠a normalidad perfecta)

    \
    Los niveles de bilirrubina encontrados en esta poblaci√≥n de pacientes cirr√≥ticos, tienen una distribuci√≥n que se desv√≠a significativamente de la normalidad, lo que significa una distribuci√≥n asim√©trica con probabilidad de cola hacia la derecha (valores altos en algunos pacientes), algo habitual en variables hep√°ticas.

```{r}
# Prueba de Shapiro-Wilk para normalidad de la albumina
cirrosis_2.csv |>
summarise(shapiro = list(shapiro.test(albumina))) |>
pull(shapiro)
```

**Interpretaci√≥n:**

-   El valor p es menor que 0.05 (p \< 0.0006387)

-   **Conclusi√≥n:** Rechazamos la hip√≥tesis nula de normalidad

-   La variable albumina **NO sigue una distribuci√≥n normal** en estos datos

-   El valor W de 0.98652 no est√° lejos de 1 pero sigue indicando que la distribuci√≥n difiere significativamente de la normalidad.

    Los niveles de alb√∫mina muestran una distribuci√≥n asim√©trica, probablemente influida por diferencias marcadas entre pacientes con distintos grados de funci√≥n hep√°tica.

```{r}
# Prueba de Shapiro-Wilk para normalidad de la Edad
cirrosis_2.csv |>
summarise(shapiro = list(shapiro.test(edad))) |>
pull(shapiro)
```

**Interpretaci√≥n:**

-   El valor p es ligeramente menor que 0.05 (por ejemplo, p = 0.03)

-   **Conclusi√≥n:** Rechazamos la hip√≥tesis nula de normalidad

-   La **edad NO sigue estrictamente una distribuci√≥n normal**, aunque el valor W cercano a 1 indica una desviaci√≥n leve

    La edad de los pacientes presenta una distribuci√≥n que se aproxima bastante a la normalidad, pero con una desviaci√≥n estad√≠sticamente significativa. Esto podr√≠a deberse a peque√±as asimetr√≠as en la distribuci√≥n de edades en la muestra.
